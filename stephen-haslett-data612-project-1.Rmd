---
title: "Data 612 Project 1 Global Baseline Predictors and RMSE"
author: "Stephen Haslett"
date: "6/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(kableExtra)
```


#### Load the ratings data into a dataframe.
```{r, warning=FALSE, message=FALSE}
csv_file <- 'https://raw.githubusercontent.com/stephen-haslett/data612/612-project-1/movie_ratings.csv'
movie_ratings_data <- read.csv(csv_file, header = TRUE, sep = ',', stringsAsFactors = FALSE)
colnames(movie_ratings_data) <- gsub('.', ' ', colnames(movie_ratings_data), fixed = TRUE)
movie_ratings_data %>% kable(caption = 'Movie Ratings') %>% kable_styling('striped', full_width = TRUE)
```


### Create a user-item matrix.
```{r, warning=FALSE, message=FALSE}
rownames(movie_ratings_data) <- movie_ratings_data$Viewers
ratings <- select(movie_ratings_data, 2:7)
user_item_matrix <- data.matrix(ratings)
user_item_matrix %>% kable(caption = 'Movie Ratings') %>% kable_styling('striped', full_width = TRUE)
```


#### Break your ratings into separate training and test datasets.
```{r, warning=FALSE, message=FALSE}
sample <- sample.int(n = nrow(user_item_matrix), size = floor(0.7 * nrow(user_item_matrix)), replace = FALSE)
train_data <- user_item_matrix[sample, ]
test_data  <- user_item_matrix[-sample, ]

train_data %>% kable(caption = 'Training Data') %>% kable_styling('striped', full_width = TRUE)
test_data %>% kable(caption = 'Test Data') %>% kable_styling('striped', full_width = TRUE)
```


#### Using your training data, calculate the raw average (mean) rating for every user-item combination.
```{r, warning=FALSE, message=FALSE}
training_average_mean<-mean(as.numeric(as.matrix(train_data)), na.rm = TRUE)
training_average_mean
```


#### Calculate the RMSE for raw average for both your training data and your test data.
```{r, warning=FALSE, message=FALSE}
training_error <- train_data - training_average_mean
training_error %>% kable(caption = 'Training Data Error') %>% kable_styling('striped', full_width = TRUE)
```


#### Training data RMSE.
```{r, warning=FALSE, message=FALSE}
training_rmse <- sqrt(mean((training_error ^ 2), na.rm = TRUE))
training_rmse
```


```{r, warning=FALSE, message=FALSE}
test_error <- test_data - training_average_mean
test_error %>% kable(caption = 'Test Data Error') %>% kable_styling('striped', full_width = TRUE)
```


#### Test data RMSE.
```{r, warning=FALSE, message=FALSE}
test_rmse <- sqrt(mean((test_error ^ 2), na.rm = TRUE))
test_rmse
```


#### Using your training data, calculate the bias for each user and each item.
```{r, warning=FALSE, message=FALSE}
user_bias <- rowMeans(user_item_matrix, na.rm = TRUE) - training_average_mean
user_bias %>% kable(caption = 'User Bias') %>% kable_styling("striped", full_width = TRUE)
```


```{r, warning=FALSE, message=FALSE}
item_bias <- colMeans(user_item_matrix, na.rm = TRUE) - training_average_mean
item_bias %>% kable(caption = 'Item Bias') %>% kable_styling("striped", full_width = TRUE)
```


#### From the raw average, and the appropriate user and item biases, calculate the baseline predictors 
for every user-item combination.
```{r, warning=FALSE, message=FALSE}
base <- as.data.frame(matrix(nrow = 10, ncol = 6))
for (i in 1:length(user_bias)){
  row <- c(user_bias + item_bias[i] + training_average_mean)
  base[i, ] <- row
}

base[base > 6] <- 6

dim(movie_ratings_data)
rownames(base) <- rownames(user_item_matrix)
colnames(base) <- colnames(na.omit(user_item_matrix))
kable(round(base, 2))
```




