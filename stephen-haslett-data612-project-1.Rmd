---
title: "Data 612 Project 1 Global Baseline Predictors and RMSE"
author: "Stephen Haslett"
date: "6/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(caTools)
library(tidyverse)
library(kableExtra)
```


## Load the ratings data into a dataframe.
```{r, warning=FALSE, message=FALSE}
csv_file <- 'https://raw.githubusercontent.com/stephen-haslett/data612/612-project-1/movie_ratings.csv'
movie_ratings_data <- read.csv(csv_file, header = TRUE, sep = ',', stringsAsFactors = FALSE)

# Replace period spacers in movie names with spaces to make them more readable.
colnames(movie_ratings_data) <- gsub('.', ' ', colnames(movie_ratings_data), fixed = TRUE)

# Set the row name values to the Viewers' column values, then remove the Viewers column as it is no longer needed.
rownames(movie_ratings_data) <- movie_ratings_data$Viewers
movie_ratings_data$Viewers = NULL

movie_ratings_data %>% kable(caption = 'Movie Ratings') %>% kable_styling('striped', full_width = TRUE)
```


## Break your ratings into separate training and test datasets.

### Split the data 50/50 (1/2 training data, 1/2 test data)
```{r, warning=FALSE, message=FALSE}
sample <- sample.split(movie_ratings_data, SplitRatio = 0.5)
train_data <- subset(movie_ratings_data, sample == TRUE)
test_data <- subset(movie_ratings_data, sample == FALSE)

train_data %>% kable(caption = 'Training Data') %>% kable_styling('striped', full_width = TRUE)
test_data %>% kable(caption = 'Test Data') %>% kable_styling('striped', full_width = TRUE)
```



## Using your training data, calculate the raw average (mean) rating for every user-item combination.

### User Averages
```{r, warning=FALSE, message=FALSE}
user_average <- rowMeans(train_data, na.rm = TRUE)
user_average_dframe <- as.data.frame(user_average)
user_average_dframe %>% kable(caption = 'User Averages') %>% kable_styling('striped', full_width = TRUE)
```



### Item Averages
```{r, warning=FALSE, message=FALSE}
item_average <-  colMeans(train_data, na.rm = TRUE)
item_average_dframe <- as.data.frame(item_average)
item_average_dframe %>% kable(caption = 'Item Averages') %>% kable_styling('striped', full_width = TRUE)
```

## Calculate the RMSE for raw average for both your training data and your test data.

### Training Data Mean
```{r, warning=FALSE, message=FALSE}
training_matrix <- as.matrix(train_data)
training_data_mean <- mean(training_matrix, na.rm = TRUE)
training_data_mean
```


### Training Data RMSE
```{r, warning=FALSE, message=FALSE}
training_data_rmse <- sqrt(mean(as.matrix((train_data - training_data_mean) ^2), na.rm = TRUE))
training_data_rmse
```


### Test Data Mean
```{r, warning=FALSE, message=FALSE}
test_matrix <- as.matrix(test_data)
test_data_mean <-mean(test_matrix, na.rm = TRUE)
test_data_mean
```


### Test Data RMSE
```{r, warning=FALSE, message=FALSE}
test_data_rmse <- sqrt(mean(as.matrix((test_data - test_data_mean) ^2), na.rm = TRUE))
test_data_rmse
```


## Using your training data, calculate the bias for each user and each item.

### User Bias
```{r, warning=FALSE, message=FALSE}
user_bias <- user_average_dframe - training_data_mean
user_bias %>% kable(caption = 'User Bias') %>% kable_styling("striped", full_width = TRUE)
```


### Item Bias
```{r, warning=FALSE, message=FALSE}
item_bias <- item_average_dframe - training_data_mean
item_bias %>% kable(caption = 'Item Bias') %>% kable_styling("striped", full_width = TRUE)
```


## From the raw average, and the appropriate user and item biases, calculate the baseline predictors
for every user-item combination.
```{r, warning=FALSE, message=FALSE}
baseline <- data.frame()

for (count in 1:nrow(user_bias)){
  result <- c(training_data_mean + user_bias[count, 1] + item_bias[1])
  result <- result[[1]]
  result[result < 1] <- 1.00
  result[result > 5] <- 5.00
  baseline <- rbind(baseline, result)
}

colnames(baseline) <- colnames(movie_ratings_data)
rownames(baseline) <- rownames(user_bias)
baseline  %>% kable(caption = 'Baseline Predictors') %>% kable_styling("striped", full_width = TRUE)
```
